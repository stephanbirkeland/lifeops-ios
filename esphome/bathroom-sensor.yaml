# Bathroom Multi-Sensor
# ESP32-C3 Super Mini + BME280 + AM312 PIR
# Purpose: Auto-lights, humidity tracking for ventilation

substitutions:
  device_name: bathroom-sensor
  friendly_name: "Bathroom Sensor"

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}

esp32:
  board: esp32-c3-devkitm-1
  framework:
    type: esp-idf

packages:
  common: !include common.yaml

# No deep sleep for bathroom - need instant motion response
# Use USB power instead of battery

i2c:
  sda: GPIO6
  scl: GPIO7
  scan: true

sensor:
  - platform: bme280_i2c
    temperature:
      name: "Bathroom Temperature"
      id: bathroom_temp
      oversampling: 2x
    humidity:
      name: "Bathroom Humidity"
      id: bathroom_humidity
      oversampling: 2x
      on_value_range:
        - above: 70
          then:
            - homeassistant.event:
                event: esphome.high_humidity
                data:
                  room: bathroom
                  humidity: !lambda 'return id(bathroom_humidity).state;'
    pressure:
      name: "Bathroom Pressure"
    address: 0x76
    update_interval: 30s  # More frequent for humidity monitoring

binary_sensor:
  - platform: gpio
    pin:
      number: GPIO4
      mode: INPUT_PULLDOWN
    name: "Bathroom Motion"
    id: bathroom_motion
    device_class: motion
    filters:
      - delayed_off: 120s  # 2 min delay - accounts for shower time

# Bathroom-specific: Track when humidity is elevated (shower detection)
  - platform: template
    name: "Bathroom Shower Active"
    id: shower_active
    device_class: moisture
    lambda: |-
      return id(bathroom_humidity).state > 75;
